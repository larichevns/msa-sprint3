# Реестр событий Saga-хореографии оформления заказа

## Описание Saga
Saga-хореография для процесса оформления заказа включает следующие основные этапы:
1. Создание заказа
2. Резервирование товаров на складе
3. Обработка платежа
4. Планирование доставки
5. Завершение или отмена заказа

## Реестр событий

| Этап | Тип события | Название | Описание |
|------|-------------|----------|----------|
| Создание заказа | domain | OrderCreated | Заказ создан покупателем |
| Резервирование товаров | domain | InventoryReserved | Товары успешно зарезервированы на складе |
| Ошибка резервирования | failure | InventoryReservationFailed | Не удалось зарезервировать товары (нет в наличии) |
| Обработка платежа | domain | PaymentProcessed | Платеж успешно обработан |
| Ошибка платежа | failure | PaymentFailed | Платеж отклонен (недостаточно средств, проблемы с картой) |
| Планирование доставки | domain | DeliveryScheduled | Доставка запланирована |
| Ошибка доставки | failure | DeliverySchedulingFailed | Не удалось запланировать доставку |
| Завершение заказа | domain | OrderCompleted | Заказ успешно завершен |
| Отмена заказа | domain | OrderCancelled | Заказ отменен из-за ошибок |
| Освобождение товаров | compensation | InventoryReleased | Товары освобождены при отмене заказа |
| Возврат средств | compensation | PaymentRefunded | Средства возвращены покупателю |
| Отмена доставки | compensation | Deliverycancelled | Доставка отменена |
| Уведомление отправлено | domain | NotificationSent | Уведомление отправлено пользователю |
| Таймаут платежа | timeout | PaymentTimeout | Превышено время ожидания платежа |
| Таймаут резервирования | timeout | InventoryReservationTimeout | Превышено время резервирования товара |
| Обновление статуса доставки | domain | DeliveryStatusUpdated | Статус доставки обновлен логистическим провайдером |

## Описание событий

### Domain Events (Доменные события)
- **OrderCreated**: Инициирует всю Saga. Содержит информацию о составе заказа, покупателе, адресе доставки
- **InventoryReserved**: Подтверждает резервирование товаров на складе
- **PaymentProcessed**: Подтверждает успешную оплату заказа
- **DeliveryScheduled**: Подтверждает планирование доставки
- **OrderCompleted**: Финальное событие успешного завершения заказа
- **NotificationSent**: Уведомление пользователя о статусе заказа

### Failure Events (События ошибок)
- **InventoryReservationFailed**: Товары недоступны для резервирования
- **PaymentFailed**: Платеж не прошел (недостаток средств, проблемы с картой)
- **DeliverySchedulingFailed**: Невозможно запланировать доставку

### Compensation Events (Компенсационные события)
- **InventoryReleased**: Освобождение зарезервированных товаров при отмене
- **PaymentRefunded**: Возврат средств покупателю
- **DeliveryCanсelled**: Отмена запланированной доставки
- **OrderCancelled**: Отмена заказа

### Timeout Events (События таймаутов)
- **PaymentTimeout**: Превышено время ожидания платежа (например, 15 минут)
- **InventoryReservationTimeout**: Товары слишком долго находятся в резерве

## Правила обработки событий

1. **OrderCreated** → запускает резервирование товаров в Inventory Service
2. **InventoryReserved** → запускает обработку платежа в Payment Service  
3. **PaymentProcessed** → запускает планирование доставки в Delivery Service
4. **DeliveryScheduled** → завершает успешную Saga (OrderCompleted)

При любой ошибке запускаются компенсационные действия в обратном порядке.